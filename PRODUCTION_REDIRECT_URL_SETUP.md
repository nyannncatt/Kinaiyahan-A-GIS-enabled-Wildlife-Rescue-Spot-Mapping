# Production Redirect URL Setup Guide

## The Problem

Currently, the reset password link uses `window.location.origin`, which means:
- **Development**: `http://localhost:5173/reset-password`
- **Production**: Will use whatever domain the user is on (could be wrong if behind a proxy/CDN)

## The Solution

We've updated the code to use an environment variable `VITE_APP_URL` that you can set differently for production.

## Setup Steps

### 1. Create Environment Files

Create these files in your project root:

**`.env.local`** (for local development - optional, already works with `window.location.origin`):
```env
VITE_APP_URL=http://localhost:5173
```

**`.env.production`** (for production):
```env
VITE_APP_URL=https://your-production-domain.com
```

**Important**: Replace `your-production-domain.com` with your actual production domain (e.g., `https://kinaiyahan-wildlife-gis.vercel.app` or your custom domain).

### 2. Configure Supabase Redirect URLs

1. Go to your Supabase Dashboard: https://supabase.com/dashboard
2. Navigate to **Authentication** → **URL Configuration**
3. Under **Redirect URLs**, add:
   - `http://localhost:5173/reset-password` (for local development)
   - `https://your-production-domain.com/reset-password` (for production)
   - Add any other domains where your app is hosted (staging, preview deployments, etc.)

   **Important:** Supabase will only redirect to URLs that are in this allowlist for security reasons.

### 3. For Vercel/Netlify Deployments

If you're using Vercel, Netlify, or similar platforms:

1. Go to your project settings
2. Find **Environment Variables**
3. Add:
   - **Name**: `VITE_APP_URL`
   - **Value**: `https://your-production-domain.com`
   - **Environment**: Production (and Preview if you want)

### 4. For Custom Domain

If you have a custom domain:
```env
VITE_APP_URL=https://kinaiyahan-wildlife-gis.com
```

### 5. Test

1. Deploy to production with the environment variable set
2. Request a password reset from production
3. Check the email - the link should point to your production domain
4. Click the link - it should redirect to your production reset password page

## How It Works

The code now checks for `VITE_APP_URL` first:
```typescript
const baseUrl = import.meta.env.VITE_APP_URL || window.location.origin;
```

- If `VITE_APP_URL` is set → uses that (production)
- If not set → uses `window.location.origin` (development fallback)

## Email Template

**You don't need to change the email template!** 

The Supabase email template uses `{{ .ConfirmationURL }}` which is automatically generated by Supabase based on the `redirectTo` parameter we pass in the code. So when you update the code to use the production URL, the email links will automatically use the correct URL.

## Files Updated

- ✅ `src/components-enfo/ProfileSection.tsx` - Reset password from profile
- ✅ `src/sign-in-side/components/ForgotPassword.tsx` - Reset password from login page
- ✅ `src/services/auth.ts` - Already was using `VITE_APP_URL`

## Troubleshooting

### Links still point to localhost
- Check that `VITE_APP_URL` is set in your production environment
- Rebuild/redeploy after setting the environment variable
- Check browser console for any errors

### Redirect URL not allowed error
- Make sure you added the production URL to Supabase's Redirect URLs allowlist
- Check that the URL matches exactly (including `https://` and `/reset-password`)

### Email template shows wrong URL
- The email template doesn't need to be changed - it uses `{{ .ConfirmationURL }}` which is auto-generated
- If the URL is wrong, check that `VITE_APP_URL` is set correctly in your environment

